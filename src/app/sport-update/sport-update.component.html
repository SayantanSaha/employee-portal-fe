<div class="container">
  <div class="card shadow">

    <div class="card-body">
      <div class="row">
        <div class="col">
          <h1 style="color: red; text-align: left; margin-bottom: 10px;text-decoration: underline;">
            Update your Sports Interest:</h1>
        </div>
        </div>
        <div class="row">
        <div class="col" style="text-align: right">
          <label class="upload-icon-label" style="margin-left: 3%;color: green;"
            *ngIf="!employee?.AllotmentId || employee?.AllotmentId === null" title="RB quarter Exist?"
            (click)="pullEbaPopup()">
            If you've applied or reside in a quarter, click Pull family/domestic help dtls. from EBA to
            retrieve Family. &nbsp;
            <!-- <i class="bi bi-question-circle btn btn-warning enlarge-on-hover" (click)="hoverClick($event)"></i> -->
            <button type="button" class="btn btn-danger enlarge-on-hover" (click)="hoverClick($event)">
              Pull family/domestic help dtls. from EBA
            </button>
          </label>
            &nbsp;
          <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"
            (click)="addMember();pullEbaCardPopup('relative','i','j')">
            +Add Family
          </button>

        </div>
      </div>

      <div class="row">
        <div class="col-md">
          <div class="card shadow table-responsive">
            <div class="card-body">
              <table class="table table-stripped">
                <thead>
                  <tr>
                    <th>Sl No.</th>
                    <th>Eba Card</th>
                    <th>Name<span class="text-danger">*</span></th>
                    <th>Gender<span class="text-danger">*</span></th>
                    <th>Relation<span class="text-danger">*</span></th>
                    <th>Mobile No.<span class="text-danger">*</span></th>
                    <th>Date Of Birth<span class="text-danger">*</span></th>
                    <th>Service<span class="text-danger">*</span></th>
                    <th>Sports</th>
                    <th colspan="3">Action</th>
                  </tr>
                </thead>
                <tbody *ngIf="employee!=null && employee.relations!=null">
                  <tr *ngFor="let member of employee!.relations; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>
                      <ng-container *ngIf="member.pivot.eba_passes">
                        <ng-container *ngFor="let eba_pass of member.pivot.eba_passes; let j = index">
                          <div *ngIf="eba_pass?.eba_pass_no && eba_pass?.eba_pass_no !== null ">
                            {{ eba_pass.eba_pass_no }}
                          </div>
                          <div style="color: blue;" *ngIf="!eba_pass?.eba_pass_no || eba_pass?.eba_pass_no === null ">
                            new
                          </div>
                        </ng-container>
                      </ng-container>
                      <ng-container
                        *ngIf="!member.pivot.eba_passes || member.pivot.eba_passes==null || member.pivot.eba_passes.length==0">
                        <label class="upload-icon-label" style="margin-left: 3%;color: blue;" title="Search Eba card"
                          (click)="pullEbaCardPopup('relative','i','j')">
                          <i class="bi bi-person-vcard-fill btn btn-outline-primary enlarge-on-hover"
                            (click)="hoverClick($event);onInputReverseChange('Relations', i)"></i>
                        </label>
                      </ng-container>
                    </td>
                    <td>
                      <input *ngIf="employee!.relations" class="form-control" type="text"
                        [(ngModel)]="employee!.relations[i].pivot!.rel_name" placeholder="Name"
                        (ngModelChange)="onInputChangeMap('Relations', i)">

                    </td>
                    <td>
                      <select *ngIf="employee!.relations " class="form-control"
                        [(ngModel)]="employee!.relations[i].pivot.gender" [compareWith]="compareGender"
                        (ngModelChange)="onInputChangeMap('Relations', i)">
                        <option value="null">--Select Gender--</option>
                        <option [ngValue]="'M'">Male</option>
                        <option [ngValue]="'F'">Female</option>
                        <option [ngValue]="'O'">OTHERS</option>
                      </select>

                      <!-- <input *ngIf="employee!.relations && editable" class="form-control" type="text"
              [(ngModel)]="employee!.relations[i].pivot!.rel_type" placeholder="Relation"> -->


                    </td>
                    <td>
                      <select *ngIf="employee!.relations " class="form-control"
                        [(ngModel)]="employee!.relations[i].pivot.relation_id" [compareWith]="compareRelation"
                        (ngModelChange)="onInputChangeMap('Relations', i)">
                        <option value="null">--Select Relation--</option>
                        <option [ngValue]="relationtype.id" *ngFor="let relationtype of relationstypelist">
                          {{relationtype!.rel_desc}}</option>
                      </select>

                      <input *ngIf="employee!.relations  && employee!.relations[i].pivot.relation_id == 28"
                        class="form-control" type="text" [(ngModel)]="employee!.relations[i].pivot!.rel_text"
                        placeholder="Relation">


                    </td>
                    <td>
                      <input *ngIf="employee!.relations " class="form-control" type="text"
                        [(ngModel)]="employee!.relations[i].pivot!.rel_mobile_no" placeholder="Mobile No."
                        maxlength="10" minlength="10" (ngModelChange)="onInputChangeMap('Relations', i)"
                        (input)="onrelationMobileNo($event, i)">


                    </td>
                    <td>
                      <input *ngIf="employee!.relations " class="form-control" type="date"
                        [(ngModel)]="employee!.relations[i].pivot!.rel_dob"
                        (ngModelChange)="onInputChangeMap('Relations', i)" [max]="maxDate">


                    </td>
                    <td>
                      <select *ngIf="employee!.relations " class="form-control"
                        [(ngModel)]="employee!.relations[i].pivot.service_id" [compareWith]="compareService"
                        (ngModelChange)="onInputChangeMap('Relations', i)">
                        <option value="null">--Select Service--</option>
                        <option [ngValue]="servicetype.id" *ngFor="let servicetype of serviceTypelist">
                          {{servicetype!.service_name}}</option>
                      </select>



                    </td>

                    <td>

                      <!-- <label *ngIf="employee!.relations && editable" class="upload-icon-label"
                  style="margin-left: 3%;color: blue;" title="Sports card"
                  (click)="pullsportCardPopup()">
                  <i class="bi bi-activity btn btn-outline-primary enlarge-on-hover"
                    (click)="hoverClick($event);onInputReverseChange('Relations', i)"></i>
                </label> -->

                      <!-- <ng-container
                  *ngIf="employee!.relations ">{{member!.pivot!.sports_name}}</ng-container> -->

                      <!-- <ng-container *ngIf="employee!.relations && editable">
                  <div class="modal modal-above-header" tabindex="-1" data-bs-backdrop="false"
                    [ngStyle]="{'display': displaySportCard  }"
                    style="backdrop-filter: blur(3px);background-color: rgba(128, 128, 128, 0.7); overflow-y: auto;">
                    <div class="modal-dialog modal-dialog-centered modal-m"
                      *ngIf=" !showEBACardDetails">
                      <div class="modal-content" *ngIf="!recivedotpEBACard && !showEBACardDetails">
                        <div class="modal-header">
                          <h5 class="modal-title">
                            <b>Sport Details</b>
                          </h5>
                        </div>

                        <div class="modal-body">
                          <div class="row">
                            <div class="col-md-4" style="margin-left: 1%;">
                              <label class="form-label">Current Sports:</label>
                            </div>
                            <div class="col-md-8" style="margin-left: -7%">
                              <ng-container>{{member!.pivot!.sports_name}}</ng-container>
                            </div>
                          </div>


                          <div class="row">
                            <div class="col-md-4" style="margin-left: 1%;">
                              <label class="form-label">Sports:</label>
                            </div>
                            <div class="col-md-8" style="margin-left: -7%">
                              <ng-multiselect-dropdown [placeholder]="'Select Sports'"
                                [settings]="dropdownSettings"
                                (ngModelChange)="onInputChangeMap('Relations', i)"
                                [data]="sportsTypelist"
                                [(ngModel)]="employee!.relations[i].pivot.sports_id"
                                style="position: relative; z-index: 9999;">
                              </ng-multiselect-dropdown>
                            </div>
                          </div>
                        </div>

                        <div class="modal-footer">
                          <button type="button" class="btn btn-outline-secondary enlarge-on-hover"
                            (click)="hoverClick($event)" (click)="closeSportCardPopup()">
                            Close
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container> -->


                      <ng-multiselect-dropdown *ngIf="employee!.relations " [placeholder]="'Select Sports'"
                        [settings]="dropdownSettings" (ngModelChange)="onInputChangeMap('Relations', i)"
                        [data]="sportsTypelist" [(ngModel)]="employee!.relations[i].pivot.sports_id"
                        style="position: relative; z-index: 9999;">
                      </ng-multiselect-dropdown>
                    </td>
                    <td *ngIf=" (changesRelationMade[i])">
                      <button *ngIf="member!.pivot!.deleted_at==null" type="button"
                        class="btn btn-outline-success enlarge-on-hover" (click)="hoverClick($event)"
                        (click)="saveRelationDetails(i);onInputReverseChange('Relations', i)">Save</button>
                    </td>

                    <td>
                      <button *ngIf="member!.pivot!.id==-1" type="button"
                        class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                        (click)="deleteMember(i)">Delete</button>

                      <!-- <button *ngIf="member!.pivot!.id!==-1" type="button"
                  class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                  (click)="deleterelation(member!.pivot!.id)">Delete</button> -->
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <td>
          <ng-container>
            <div class="modal modal-above-header" tabindex="-1" data-bs-backdrop="false"
              [ngStyle]="{'display': displayEbaCard  }"
              style="backdrop-filter: blur(3px);background-color: rgba(128, 128, 128, 0.7); overflow-y: auto;">
              <div class="modal-dialog modal-dialog-centered modal-m" *ngIf=" !showEBACardDetails">
                <div class="modal-content" *ngIf="!recivedotpEBACard && !showEBACardDetails">
                  <div class="modal-header">
                    <h5 class="modal-title">
                      <b>Pull Eba Card Details </b>
                    </h5>
                  </div>

                  <div class="modal-body">
                    <div class="row">
                      <div class="col-md-4" style="margin-left: 1%;">
                        <label class="form-label">Eba Card:</label>
                      </div>
                      <div class="col-md-8" style="margin-left: -7%">
                        <input type="text" class="form-control" placeholder="EBA-xxxxxxxx" aria-label="Eba card"
                          [(ngModel)]="EbaCardNo">
                      </div>
                    </div>
                  </div>

                  <div class="modal-footer">
                    <span style="color: red; font-weight: bold;">
                      If EBA card details are unavailable, close this box and enter them manually.
                    </span>

                    <button type="button" class="btn btn-outline-secondary enlarge-on-hover"
                      (click)="hoverClick($event)" (click)="closeEbaCardPopup()">
                      Close
                    </button>

                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"
                      (click)="EbaCardDetail()" *ngIf="EbaCardNo && EbaCardNo!==null">
                      Fetch
                    </button>
                  </div>
                </div>


                <div class="modal-content" *ngIf="recivedotpEBACard && !showEBACardDetails">
                  <div class="modal-header">
                    <h5 class="modal-title">
                      <b>OTP </b>
                    </h5>
                  </div>

                  <div class="modal-body" style="text-align: center">
                    <br>
                    <div style="color: grey">
                      An OTP has sent to below this number.
                    </div>
                    <div style="color: red">
                      +91 {{getMaskedEBACardNumber()}}
                    </div>
                    <br>
                    <div class="my-4">
                      <ng-otp-input (onInputChange)="onOtpChange($event)" [config]="configOptions"></ng-otp-input>
                    </div>
                    <!--                        <button class="btn btn-lg w-100 mt-3 mb-4 py-3" [ngClass]="btnStatus">{{ this.inputDigitLeft }}</button>-->
                    <br>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary enlarge-on-hover"
                      (click)="hoverClick($event)" (click)="closeEbaCardPopup()">
                      Close
                    </button>

                    <button type="button" class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                      (click)="wrongEbaCard()">
                      Back
                    </button>

                    <button type="button" class="btn btn-outline-warning enlarge-on-hover" (click)="EbaCardDetail()"
                      [disabled]="isResendDisabled">
                      <ng-container *ngIf="!isResendDisabled; else countdown">{{ 'Resend' }}</ng-container>
                      <ng-template #countdown>Resend in {{ remainingTime }}</ng-template>
                    </button>

                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"
                      (click)="Verifyotp('ebaCardOtp')">
                      Verify
                    </button>
                  </div>
                </div>
              </div>

              <div class="modal-dialog modal-dialog-centered modal-l" *ngIf="!recivedotpEBACard && showEBACardDetails">
                <div class="modal-content" *ngIf="!recivedotpEBACard && showEBACardDetails">
                  <div class="modal-header">
                    <h5 class="modal-title">
                      <b>EBA-Card details</b>
                    </h5>
                  </div>

                  <div class="modal-body">
                    <div class="row" style="overflow-x: auto;overflow-y: hidden; white-space: nowrap;">
                      <ng-container *ngIf="EbaCardData[0]">
                        <div class="d-flex flex-column align-items-center"
                          style="width:100%; text-align: center; padding-top: 10px;">
                          <span *ngIf="EbaCardData[0] && EbaCardData[0].photo">
                            <img [src]="EbaCardData[0].photo" alt="Profile Photo" style="width: 150px; height: 128px"
                              class="rounded-circle" title="Profile Photo" />
                          </span>
                          <span style="font-size: 1.2em" *ngIf="EbaCardData[0].name">{{EbaCardData[0].name}}</span>
                          <span *ngIf="EbaCardData[0].pass_no">{{EbaCardData[0].pass_no}}</span>
                          <!--                                    <span  *ngIf="EbaCardData[0].dob">{{formatDate(EbaCardData[0].dob)}}</span>-->
                          <!--                                    <span *ngIf="EbaCardData[0].mob_no">{{EbaCardData[0].mob_no}}</span>-->
                        </div>
                      </ng-container>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary enlarge-on-hover"
                      (click)="hoverClick($event)" (click)="closeEbaCardPopup()">
                      Close
                    </button>
                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"
                      (click)="PullEbaCard()">
                      PULL
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <ng-container>
            <div class="modal modal-above-header" tabindex="-1" data-bs-backdrop="false"
              [ngStyle]="{'display': displayEba }"
              style="backdrop-filter: blur(3px);background-color: rgba(128, 128, 128, 0.7); overflow-y: auto;">
              <div class="modal-dialog modal-dialog-centered modal-m" *ngIf=" !showquarterDetails">
                <div class="modal-content" *ngIf="!recivedotp && !showquarterDetails">
                  <div class="modal-header">
                    <h5 class="modal-title">
                      <b> Pull Quarter Details </b>
                    </h5>
                  </div>

                  <div class="modal-body">
                    <div class="row">
                      <div class="col-md-4" style="margin-left: 1%;">
                        <label class="form-label">Location:</label>
                      </div>
                      <div class="col-md-8" style="margin-left: -7%">
                        <select class="form-control" [(ngModel)]="employee!.location_id" (change)="qtrtype()">
                          <option value="">--Select--</option>
                          <option [ngValue]="locationtype.location_code" *ngFor="let locationtype of locationtypelist">
                            {{locationtype!.location_name}}</option>
                        </select>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4" style="margin-left: 1%">
                        <label class="form-label">Quarter Type:</label>
                      </div>
                      <div class="col-md-8" style="margin-left: -7%">
                        <select class="form-control" [(ngModel)]="employee!.qtr_code" (change)="qtraddress($event)">
                          <option value="">--Select--</option>
                          <option [ngValue]="quartertype.type_code" *ngFor="let quartertype of quarterstypelist">
                            {{quartertype!.type_name}}</option>
                        </select>
                      </div>
                    </div>
                    <div class="row" *ngIf="blockstypelist !== null && blockstypelist.length > 0"
                      (change)="qtrBlckaddress()">
                      <div class="col-md-4" style="margin-left: 1%">
                        <label class="form-label">Block:</label>
                      </div>
                      <div class="col-md-8" style="margin-left: -7%">
                        <select class="form-control" [(ngModel)]="employee!.blck">
                          <option [ngValue]="blck.code" *ngFor="let blck of blockstypelist">
                            {{blck!.type_name}}</option>
                        </select>
                      </div>
                    </div>
                    <div class="row" *ngIf="quarterList !== null && quarterList.length > 0">
                      <div class="col-md-4" style="margin-left: 1%">
                        <label class="form-label">Quarter address:</label>
                      </div>
                      <div class="col-md-8" style="margin-left: -7%">
                        <select class="form-control" [(ngModel)]="employee!.qtr">
                          <option value="">--Select--</option>
                          <option [ngValue]="qtr" *ngFor="let qtr of quarterList">
                            {{qtr!.qtr_no}}</option>
                        </select>
                      </div>
                    </div>

                  </div>

                  <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary enlarge-on-hover"
                      (click)="hoverClick($event)" (click)="closeEbaPopup()">
                      Close
                    </button>

                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"
                      (click)="sendOtp()" *ngIf="employee!.qtr">
                      Send OTP
                    </button>
                  </div>
                </div>


                <div class="modal-content" *ngIf="recivedotp && !showquarterDetails">
                  <div class="modal-header">
                    <h5 class="modal-title">
                      <b>OTP </b>
                    </h5>
                  </div>

                  <div class="modal-body" style="text-align: center">
                    <br>
                    <div style="color: grey">
                      An OTP has sent to below this number.
                    </div>
                    <div style="color: red">
                      +91 {{getMaskedNumber()}}
                    </div>
                    <br>
                    <div class="my-4">
                      <ng-otp-input (onInputChange)="onOtpChange($event)" [config]="configOptions"></ng-otp-input>
                    </div>
                    <!--                        <button class="btn btn-lg w-100 mt-3 mb-4 py-3" [ngClass]="btnStatus">{{ this.inputDigitLeft }}</button>-->
                    <br>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary enlarge-on-hover"
                      (click)="hoverClick($event)" (click)="closeEbaPopup()">
                      Close
                    </button>

                    <button type="button" class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                      (click)="wrongQuarter()">
                      Back
                    </button>

                    <button type="button" class="btn btn-outline-warning enlarge-on-hover" (click)="sendOtp()"
                      [disabled]="isResendDisabled">
                      <ng-container *ngIf="!isResendDisabled; else countdown">{{ 'Resend' }}</ng-container>
                      <ng-template #countdown>Resend in {{ remainingTime }}</ng-template>
                    </button>

                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"
                      (click)="Verifyotp('qtrotp')">
                      Verify
                    </button>
                  </div>
                </div>
              </div>

              <div class="modal-dialog modal-dialog-centered modal-xl" *ngIf="!recivedotp && showquarterDetails">
                <div class="modal-content" *ngIf="!recivedotp && showquarterDetails">
                  <div class="modal-header">
                    <h5 class="modal-title">
                      <b>EBA details</b>
                    </h5>
                  </div>

                  <div class="modal-body">
                    <div class="row">
                      <div class="row">
                        <div class="col-md-2"><b>Name:</b></div>
                        <div class="col-md-10" style="font-size: 120%;margin-left: -6%;">
                          {{quarterDetails?.m_Item1?.[0]?.Name}}
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-2"><b>Designation:</b></div>
                        <div class="col-md-10" style="margin-left: -6%;">
                          {{quarterDetails?.m_Item1?.[0]?.Designation}}
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-2"><b>Section:</b></div>
                        <div class="col-md-10" style="margin-left: -6%;">
                          {{quarterDetails?.m_Item1?.[0]?.Section}}
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-2"><b>Address:</b></div>
                        <div class="col-md-10" style="margin-left: -6%;">
                          {{quarterDetails?.m_Item1?.[0]?.Address}}
                        </div>
                      </div>
                    </div>
                    <br>
                    <div class="row" style="overflow-x: auto;overflow-y: hidden; white-space: nowrap;">
                      <tr>
                        <ng-container *ngIf="quarterDetails?.m_Item1?.[0]?.Members">
                          <ng-container *ngFor="let member of quarterDetails?.m_Item1?.[0]?.Members; let i = index">
                            <td>
                              <div class="d-flex flex-column align-items-center"
                                style="width:100%; text-align: center; padding-top: 10px;">
                                <span *ngIf="member?.PhotoUrl">
                                  <img [src]="member.PhotoUrl" alt="Profile Photo" style="width: 150px; height: 128px"
                                    class="rounded-circle" title="Profile Photo" />
                                </span>
                                <span *ngIf="member" style="font-size: 1.2em">{{ member.MemberName }}</span>
                                <span *ngIf="member?.PassNo">{{ member.PassNo }}</span>
                              </div>
                            </td>
                          </ng-container>
                        </ng-container>

                        <ng-container *ngIf="quarterDetails?.m_Item2?.length>0">
                          <ng-container *ngFor="let item of quarterDetails?.m_Item2; let j = index">
                            <ng-container *ngFor="let itemMember of item?.Members; let k = index">
                              <td *ngIf="itemMember?.Relation == 12">
                                <div class="d-flex flex-column align-items-center"
                                  style="width:100%; text-align: center; padding-top: 10px;">
                                  <span *ngIf="itemMember?.PhotoUrl">
                                    <img [src]="itemMember.PhotoUrl" alt="Profile Photo"
                                      style="width: 150px; height: 128px" class="rounded-circle"
                                      title="Profile Photo" />
                                  </span>
                                  <span *ngIf="itemMember" style="font-size: 1.2em">{{ itemMember.Name }}</span>
                                  <span *ngIf="itemMember?.PassNo">{{ itemMember.PassNo }}</span>
                                </div>
                              </td>
                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </tr>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary enlarge-on-hover"
                      (click)="hoverClick($event)" (click)="closeEbaPopup()">
                      Close
                    </button>
                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"
                      (click)="PullEba()">
                      PULL
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </td>
      </div>
    </div>
  </div>
