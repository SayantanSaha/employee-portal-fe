<div class="row">
  <div class="col-md-12" style="padding: 2%; ">
    <div class="card shadow">

      <div class="card-header">
        <div class="float-start">
          <b>Employee Details</b>
        </div>
        <div class="float-end">
          <div *ngIf="editable">
            <a class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" [routerLink]="'/dashboard'">
              Home
            </a>
          </div>
          <div *ngIf="!editable">
            <a class="btn btn-outline-primary enlarge-on-hover"   (click)="setEdit()">
              EDIT
            </a>
          </div>
        </div>
      </div>

      <div class="card-body" style="background: linear-gradient(to bottom right, #7bdc1647,transparent);">
        <div class="accordion shadow" id="accordionExample">

          <!-- Basic Deatils Field -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                Primary Details
              </button>
            </h2>

            <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
              <ng-container *ngIf="employee!.temp_changes && employee!.temp_changes.length > 0">
                <ng-container *ngFor="let change of employee!.temp_changes">
              <div class="accordion-body" *ngIf="editable && change.model === 'Employee' && change.changed_data">
                <div class="row">
                  <div class="col-md-12">
                    <div class="card ">
                      <div class="card-body">
                        <div class="row" style="text-align: center;overflow:auto;">
                          <div class="col-md-12">
                            <div class="form-group">
                              <label class="form-label">
                                <u class="text-danger">Pending changes of Basic Data</u>
                              </label>
                            </div>
                          </div>
                        </div>


                            <div class="row"
                                 style="overflow:auto">

                              <div class="col-md-3">
                                <div style="width:100%;text-align: center;padding-top: 10px;">
                                  <span *ngIf="change.changed_data && change.changed_data.profile_photo">
                                    <img [src]="change.changed_data.profile_photo" alt="Profile Photo"
                                         style="width: 150px; height: 128px" class="rounded-circle"
                                         title="Profile Photo" />
                                  </span>
                                  <br /><br />
                                  <span *ngIf="change.changed_data && change.changed_data.sign_path">
                                    <img [src]="change.changed_data.sign_path" alt="Signature"
                                         style="width: 150px; height: 30px" class="rounded-square"
                                         title="Employee Signature" />
                                  </span>
                                </div>
                              </div>

                              <div class="col-md-9">
                                <div class="row">
                                  <div class="col-md-6" *ngIf="change.changed_data.emp_name; let empName">
                                    <div class="form-group">
                                      <label class="form-label">{{ empName ? 'Name' : '' }}</label>
                                    </div>
                                    <div class="input-group">
                                      <label *ngIf="change.changed_data.emp_title; let empTitle">
                                        {{ empTitle }}
                                      </label>
                                      &nbsp;
                                      <label>
                                        {{ empName }}
                                      </label>
                                    </div>
                                  </div>

                                  <div class="col-md-6" *ngIf="change.changed_data.emp_name_hi; let empNameHi">
                                    <div class="form-group">
                                      <label class="form-label">{{ empNameHi ? 'नाम' :''}}</label>
                                    </div>
                                    <div class="input-group">
                                      <label *ngIf="change.changed_data.emp_title_hi; let empTitleHi">
                                        {{ empTitleHi }}
                                      </label>

                                      <label>
                                        {{ empNameHi }}
                                      </label>
                                    </div>
                                  </div>
                                </div>

                                <div class="row">
                                  <div class="col-md-6" *ngIf="change.changed_data.dob; let empDOB">
                                    <div class="form-group">
                                      <label class="form-label">{{ empDOB ? 'Date Of Birth':''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{ formatDate(empDOB) }}
                                    </div>
                                  </div>

                                  <div class="col-md-6"
                                       *ngIf="(change.changed_data.gender) === 'M' ? 'Male' : (change.changed_data.gender) === 'F' ? 'Female' : (change.changed_data.gender) === 'O' ? 'OTHERS' : ''; let empGender">
                                    <div class="form-group">
                                      <label class="form-label">{{ empGender ? 'Gender':''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{ empGender }}
                                    </div>
                                  </div>
                                </div>

                                <div class="row">
                                  <div class="col-md-6" *ngIf="change.changed_data.email_id; let empEmail">
                                    <div class="form-group">
                                      <label class="form-label">{{ empEmail ? 'Email':''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{ empEmail }}
                                    </div>
                                  </div>

                                  <div class="col-md-6" *ngIf="change.changed_data.mobile; let empMobile">
                                    <div class="form-group">
                                      <label class="form-label">{{ empMobile ? 'Mobile No' : ''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{ empMobile }}
                                    </div>
                                  </div>
                                </div>

                                <div class="row">
                                  <div class="col-md-6" *ngIf="change.changed_data.doj_gs; let empDOJGS">
                                    <div class="form-group">
                                      <label class="form-label">{{ empDOJGS ? 'Date of Joining in Government Service':''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{ formatDate(empDOJGS) }}
                                    </div>
                                  </div>

                                  <div class="col-md-6" *ngIf="change.changed_data.doj_rb; let empDOJRB">
                                    <div class="form-group">
                                      <label class="form-label">{{ empDOJRB ? 'Date of Joining in Rashtrapati Bhavan'
                                        : ''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{ formatDate(empDOJRB) }}
                                    </div>
                                  </div>
                                </div>



                                <div class="row">
                                  <div class="col-md-6" *ngIf="change.changed_data.curr_add; let empCurrAdd">
                                    <div class="form-group">
                                      <label class="form-label">
                                        <u style="color: gray;">
                                          {{ empCurrAdd ? 'Present Address':''}}
                                        </u>
                                      </label>
                                    </div>
                                  </div>

                                  <div class="col-md-6" *ngIf="change.changed_data.perm_add; let empPrmAdd">
                                    <div class="form-group">
                                      <label class="form-label">
                                        <u style="color: gray;">
                                          {{ empPrmAdd ? 'Permanent Address' : ''}}
                                        </u>
                                      </label>
                                    </div>
                                  </div>
                                </div>

                                <div class="row">
                                  <div class="col-md-6" *ngIf="change.changed_data.curr_add; let empCurrAdd">
                                    <div class="form-group">
                                      <label class="form-label">{{ empCurrAdd ? 'Address':''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{empCurrAdd}}
                                    </div>
                                  </div>

                                  <div class="col-md-6" *ngIf="change.changed_data.perm_add; let empPrmAdd">
                                    <div class="form-group">
                                      <label class="form-label">{{ empPrmAdd ? ' Address' : ''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{empPrmAdd}}
                                    </div>
                                  </div>
                                </div>

                                <div class="row">
                                  <div class="col-md-6" *ngIf="change.changed_data.curr_district_name; let empCurrDist">
                                    <div class="form-group">
                                      <label class="form-label">{{ empCurrDist ? 'District':''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{empCurrDist}}
                                    </div>
                                  </div>

                                  <div class="col-md-6" *ngIf="change.changed_data.perm_district_name; let empPrmDist">
                                    <div class="form-group">
                                      <label class="form-label">{{ empPrmDist ? ' District' : ''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{empPrmDist}}
                                    </div>
                                  </div>
                                </div>

                                <div class="row">
                                  <div class="col-md-6" *ngIf="change.changed_data.curr_state_name; let empCurrState">
                                    <div class="form-group">
                                      <label class="form-label">{{ empCurrState ? 'State':''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{empCurrState}}
                                    </div>
                                  </div>

                                  <div class="col-md-6" *ngIf="change.changed_data.perm_state_name; let empPrmState">
                                    <div class="form-group">
                                      <label class="form-label">{{ empPrmState ? ' State' : ''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{empPrmState}}
                                    </div>
                                  </div>
                                </div>

                                <div class="row">
                                  <div class="col-md-6" *ngIf="change.changed_data.curr_pin; let empCurrPin">
                                    <div class="form-group">
                                      <label class="form-label">{{ empCurrPin ? 'Pin No.':''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{empCurrPin}}
                                    </div>
                                  </div>

                                  <div class="col-md-6" *ngIf="change.changed_data.perm_pin; let empPrmPin">
                                    <div class="form-group">
                                      <label class="form-label">{{ empPrmPin ? ' Pin No.' : ''}}</label>
                                    </div>
                                    <div class="input-group">
                                      {{empPrmPin}}
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>

              <div class="accordion-body" >
                <div class="row">
                  <div class="col-md-3">
                    <div class="card shadow" style="overflow: auto;">
                      <div class="card-body">
                        <div style="width:100%;text-align: center;padding-top: 10px;">
                          <span *ngIf="employee && employee.profile_photo">
                            <img [src]="employee.profile_photo" alt="Profile Photo" style="width: 150px; height: 128px"
                                 class="rounded-circle" title="Profile Photo" />
                          </span>
                          <br /><br />
                          <span *ngIf="employee && employee.sign_path">
                            <img [src]="employee.sign_path" alt="Signature" style="width: 150px; height: 30px"
                                 class="rounded-square" title="Employee Signature" />
                          </span>

                          <br /><br />
                          <label for="profile_photo" class="upload-icon-label" *ngIf="editable"
                                 title="Upload Profile Photo">
                            <i class="bi bi-cloud-arrow-up btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"></i>
                          </label>
                          &nbsp;&nbsp;
                          <label for="sign_path" class="upload-icon-label" *ngIf="editable" title="Upload Signature">
                            <i class="bi bi-cloud-arrow-up btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"></i>
                          </label>

                          <input type="file" class="custom-file-input" id="profile_photo"
                                 (change)="onProfilePhotoSelected($event, 'Profile Photo')" style="display: none"
                                 *ngIf="editable">

                          <input type="file" class="custom-file-input" id="sign_path"
                                 (change)="onProfilePhotoSelected($event , 'Employee Sign')" style="display: none"
                                 *ngIf="editable">

                          <br /><br />
                          <div *ngIf="employee">
                            <span style="font-size: 1.2em">{{employee.emp_name!}}</span><br />
                            <span style="font-size: 1.2em">{{employee.id_cards![0]!.card_no}}</span><br />
                            <span style="font-size: 0.8em">{{employee!.designations![0]!.desg_desc!}}</span><br />
                            <span style="font-size: 0.8em">{{employee!.organization!.org_desc}}</span><br />
                            <span style="font-size: 0.8em">{{employee!.email_id!}}</span><br />
                            <span style="font-size: 1em">{{employee!.mobile!}}</span><br />
                          </div>
                          <br /><br />

                          <!--                          aadhar card-->
                          <!--                          <label for="aadhar_card" class="upload-icon-label" *ngIf="editable" title="Upload Aadhar card">-->
                          <!--                            <i class="bi bi-cloud-arrow-up btn btn-outline-warning"></i>-->
                          <!--                          </label>-->
                          <!--                          <input type="file" class="custom-file-input"-->
                          <!--                                 (change)="onaadharSelected($event)"-->
                          <!--                                 *ngIf="editable" title="Upload id proof">-->
                          <!--                                                    <span *ngIf="employee && employee.aadhar_card">-->

                          <!--                                                      <a href="{{apiUrl}}getFile/{{employee.aadhar_card}}"-->
                          <!--                                                         class="btn btn-outline-primary" title="id proof" target="_blank">-->
                          <!--                                                            <i class="bi bi-eye"></i>-->
                          <!--                                                          </a>-->
                          <!--                                                    </span>-->

                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-9">
                    <div class="card shadow">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md">
                            <label class="form-label">Name</label>
                            <div *ngIf="editable" class="input-group mb-1">
                              <div class="col-md-2">
                                <select class="form-control" [(ngModel)]="employee!.emp_title"
                                        (ngModelChange)="onInputChange()">
                                  <option value="null">Select Title</option>
                                  <option>Mr</option>
                                  <option>Ms</option>
                                  <option>Miss</option>
                                  <option>Mrs</option>
                                  <option>Dr</option>
                                </select>
                              </div>
                              <div class="col-md-10">
                                <input type="text" class="form-control" placeholder="Name" aria-label="Name"
                                       [(ngModel)]="employee!.emp_name" (change)="validateEngName()"
                                       (ngModelChange)="onInputChange()">
                              </div>
                            </div>
                            <div *ngIf="!editable" class="input-group mb-3">
                              {{employee!.emp_title}}. {{employee!.emp_name}}
                            </div>
                          </div>

                          <div class="col-md">
                            <label class="form-label">नाम</label>
                            <div *ngIf="editable" class="input-group mb-3">
                              <div class="col-md-2">
                                <select class="form-control" [(ngModel)]="employee!.emp_title_hi"
                                        (ngModelChange)="onInputChange()">
                                  <option value="null">अभिवादन का चयन करें</option>
                                  <option>श्री</option>
                                  <option>सुश्री</option>
                                  <option>कुमारी</option>
                                  <option>श्रीमती</option>
                                  <option>डॉ</option>
                                </select>
                              </div>
                              <div class="col-md-10">
                                <input type="text" class="form-control" placeholder="नाम" aria-label="Server"
                                       [(ngModel)]="employee!.emp_name_hi" (change)="validateHindiName()"
                                       title="कृपया नाम हिंदी में दर्ज करें" (ngModelChange)="onInputChange()">
                              </div>
                            </div>
                            <div *ngIf="!editable" class="input-group mb-3">
                              {{employee!.emp_title_hi}} {{employee!.emp_name_hi}}
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-md">
                            <label class="form-label">Email</label>
                            <div *ngIf="editable" class="input-group mb-3">
                              <input type="email" class="form-control" placeholder="Email" aria-label="Email"
                                     [(ngModel)]="employee!.email_id" (change)="validateEmail()"
                                     (ngModelChange)="onInputChange()">
                            </div>
                            <div *ngIf="!editable" class="input-group mb-3">
                              {{employee!.email_id}}
                            </div>
                          </div>

                          <div class="col-md">
                            <label class="form-label">Mobile</label>
                            <div *ngIf="editable" class="input-group mb-3">
                              <input type="text" maxlength="10" minlength="10" class="form-control" placeholder="Mobile"
                                     aria-label="Mobile" [(ngModel)]="employee!.mobile" (input)="onMobileNo($event)"
                                     (ngModelChange)="onInputChange()">
                            </div>

                            <div *ngIf="!editable" class="input-group mb-3">
                              {{employee!.mobile}}
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-md">
                            <label class="form-label">Date Of Birth</label>
                            <div *ngIf="editable" class="input-group mb-3">
                              <input type="date" class="form-control" placeholder="Date Of Birth"
                                     aria-label="Date Of Birth" [(ngModel)]="employee!.dob" (ngModelChange)="onInputChange()"
                                     [max]="maxDate">
                            </div>
                            <div *ngIf="!editable" class="input-group mb-3">
                              {{formatDate(employee!.dob)}}
                            </div>
                          </div>

                          <div class="col-md">
                            <label class="form-label">Gender</label>
                            <div *ngIf="editable" class="input-group mb-3">
                              <select *ngIf="employee && editable" class="form-control" [(ngModel)]="employee!.gender"
                                      [compareWith]="compareGender" (ngModelChange)="onInputChange()">
                                <option value="null">--Select Gender--</option>
                                <option [ngValue]="'M'">Male</option>
                                <option [ngValue]="'F'">Female</option>
                                <option [ngValue]="'O'">OTHERS</option>
                              </select>
                            </div>

                            <div *ngIf="!editable" class="input-group mb-3">
                              {{
                              employee?.gender === 'M' ? 'Male' :
                                employee!.gender === 'F' ? 'Female' :
                                  employee!.gender === 'O' ? 'Others' :
                                    'N/A'
                              }}
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-md-6">
                            <label class="form-label">Date of Joining in Government Service</label>
                            <div *ngIf="editable" class="input-group mb-3">
                              <input type="date" class="form-control" placeholder="Date Of Joining"
                                     aria-label="Date Of Joining" [(ngModel)]="employee!.doj_gs"
                                     (change)="checkDateOfJoining()" (ngModelChange)="onInputChange()" [max]="maxDate">
                            </div>
                            <div *ngIf="!editable" class="input-group mb-3">
                              {{formatDate(employee!.doj_gs)}}
                            </div>
                          </div>

                          <div class="col-md-6">
                            <label class="form-label">Date of Joining in Rashtrapati Bhavan</label>
                            <div *ngIf="editable" class="input-group mb-3">
                              <input type="date" class="form-control" placeholder="Date Of Joining"
                                     aria-label="Date Of Joining" [(ngModel)]="employee!.doj_rb"
                                     (change)="checkDateOfJoining()" (ngModelChange)="onInputChange()" [max]="maxDate">
                            </div>
                            <div *ngIf="!editable" class="input-group mb-3">
                              {{formatDate(employee!.doj_rb)}}
                            </div>
                          </div>
                        </div>


                        <div class="row">
                          <div class="col-md-6">
                            <label class="form-label">Date of retirement</label>
                            <div class="input-group mb-3">
                              {{formatDate(employee!.dor)}}
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-md-6">
                            <label class="form-label"><u>Present Address</u></label>
                            <div *ngIf="editable">

                              <div class="row">&nbsp;</div>
                              <div class="row">
                                <div class="col-md-12">
                                  <input type="text" class="form-control" placeholder="Address" aria-label="address"
                                         [(ngModel)]="employee!.curr_add">
                                </div>
                              </div>

                              <div class="row">
                                <div class="col-md-12">
                                  <select class="form-control" [(ngModel)]="employee!.curr_state"
                                          [compareWith]="compareState" (ngModelChange)="onStateChange($event,'curr')"
                                          (ngModelChange)="onInputChange()">
                                    <option value="null">Select State</option>
                                    <option [ngValue]="state" *ngFor="let state of states">{{state.state_name}}</option>
                                  </select>
                                </div>
                              </div>

                              <div class="row">
                                <div class="col-md-12">
                                  <select class="form-control" [(ngModel)]="employee!.curr_district"
                                          [compareWith]="compareDist" (ngModelChange)="onInputChange()">
                                    <option value="null">Select District</option>
                                    <option [ngValue]="dist" *ngFor="let dist of currDistricts">{{dist.district_name}}
                                    </option>
                                  </select>
                                </div>
                              </div>

                              <div class="row">
                                <div class="col-md-12">
                                  <input type="text" maxlength="6" minlength="6" class="form-control" placeholder="PIN"
                                         aria-label="pin" [(ngModel)]="employee!.curr_pin" (input)="validateCurrPin($event)"
                                         (ngModelChange)="onInputChange()">
                                </div>
                              </div>
                            </div>

                            <div *ngIf="!editable" class="input-group mb-3">
                              {{employee!.curr_add}},<br />
                              {{employee!.curr_district!.district_name}}<br />
                              {{employee!.curr_state!.state_name}} - {{employee!.curr_pin}}
                            </div>
                          </div>

                          <div class="col-md-6">
                            <label class="form-label"><u>Permanent Address</u></label>
                            <div *ngIf="editable">

                              <div class="row">
                                <div class="col-md-12">
                                  <input type="checkbox" id="cpaddress" [(ngModel)]="isCpAddressChecked"
                                         (change)="cPAddress()"> &nbsp; <b class="text-danger">Same as Present Address</b>
                                </div>
                              </div>

                              <div class="row">
                                <div class="col-md-12">
                                  <input type="text" class="form-control" placeholder="Address" aria-label="address"
                                         [(ngModel)]="employee!.perm_add" [readonly]="isCpAddressChecked"
                                         (ngModelChange)="onInputChange()">
                                </div>
                              </div>

                              <div class="row">
                                <div class="col-md-12">
                                  <select class="form-control" [(ngModel)]="employee!.perm_state"
                                          [compareWith]="compareState" (ngModelChange)="onStateChange($event,'perm')"
                                          [disabled]="isCpAddressChecked" (ngModelChange)="onInputChange()">
                                    <option value="null">Select State</option>
                                    <option [ngValue]="state" *ngFor="let state of states">{{state.state_name}}</option>
                                  </select>
                                </div>
                              </div>

                              <div class="row">
                                <div class="col-md-12">
                                  <select class="form-control" [(ngModel)]="employee!.perm_district"
                                          [compareWith]="compareDist" [disabled]="isCpAddressChecked"
                                          (ngModelChange)="onInputChange()">
                                    <option value="null">Select District</option>
                                    <option [ngValue]="dist" *ngFor="let dist of permDistricts">{{dist.district_name}}
                                    </option>
                                  </select>
                                </div>
                              </div>

                              <div class="row">
                                <div class="col-md-12">
                                  <input type="text" maxlength="6" minlength="6" class="form-control" placeholder="PIN"
                                         aria-label="pin" [(ngModel)]="employee!.perm_pin" (input)="validatePermPin($event)"
                                         [readonly]="isCpAddressChecked" (ngModelChange)="onInputChange()">
                                </div>
                              </div>


                            </div>
                            <div *ngIf="!editable" class="input-group mb-3">
                              {{employee!.perm_add}},<br />
                              {{employee!.perm_district!.district_name}}<br />
                              {{employee!.perm_state!.state_name}} - {{employee!.perm_pin}}

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row" *ngIf="changesMade">
                  <div class="col-md-12">
                    <div class="card shadow">
                      <div class="card-body">
                        <div *ngIf="editable" style="text-align: center;">
                          <button class="btn btn-outline-primary enlarge-on-hover" (click)="hoverClick($event)" (click)="savePrimaryDetails()">
                            Save Changes
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <!-- Designation/Promotion Deatils Field -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                Designation/Promotion Details
              </button>
            </h2>

            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">

              <div class="accordion-body" *ngIf="editable">
                <div class="row">
                  <div class="col-md-10"></div>
                  <div class="col-md-2" style="text-align: right">
                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" (click)="addDesignation()">
                      +Add Designation
                    </button>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md">
                    <div class="card shadow table-responsive">
                      <div class="card-body">
                        <div class="row" style="text-align: center;">
                          <div class="col-md">
                            <div class="form-group">
                              <label class="form-label">
                                <u class="text-danger">Pending changes of Designation/Promotion Data</u>
                              </label>
                            </div>
                          </div>
                        </div>
                        <table class="table table-stripped">
                          <thead>
                          <tr>
                            <!-- <th>Sl No.</th> -->
                            <th>Designation</th>
                            <th>Joining Date</th>
                            <th>Order No.</th>
                            <th>Order Date</th>
<!--                            <th>Order File</th>-->
                          </tr>
                          </thead>
                          <tbody *ngIf="employee!.temp_changes && employee!.temp_changes.length > 0">
                          <ng-container *ngFor="let change of employee!.temp_changes; let i = index">
                            <tr *ngIf="change.model === 'promotion' && change.changed_data">
                              <td *ngIf="change.model === 'promotion'">{{ change.changed_data.desg_desc }}</td>
                              <td *ngIf="change.model === 'promotion'">{{ formatDate(change.changed_data.join_date)}}</td>
                              <td *ngIf="change.model === 'promotion'">{{ change.changed_data.order_no }}</td>
                              <td *ngIf="change.model === 'promotion'">{{ formatDate(change.changed_data.order_date)}}</td>
<!--                              <td *ngIf="change.model === 'promotion'">{{ change.changed_data.order_path }}</td>-->
                            </tr>
                          </ng-container>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="accordion-body">
                <div class="row">
                  <div class="col-md">
                    <div class="card shadow table-responsive">
                      <div class="card-body">
                        <table class="table table-stripped">
                          <thead>
                          <tr>
                            <th>Sl No.</th>
                            <th>Designation</th>
                            <th>Joining Date</th>
                            <th>Order No.<span class="text-danger">*</span></th>
                            <th>Order Date<span class="text-danger">*</span></th>
                            <th colspan="2">Order File</th>
                            <th *ngIf="editable" colspan="2">Action</th>
                          </tr>
                          </thead>
                          <tbody *ngIf="employee!=null && employee.designations!=null">
                          <tr *ngFor="let desg of employee!.designations; let i = index">
                            <td>{{i+1}}</td>
                            <td>
                              <select *ngIf="employee!.designations && editable" class="form-control"
                                      [(ngModel)]="employee!.designations[i].pivot.designation_id"
                                      [compareWith]="compareDesignation" (ngModelChange)="onInputChangeMap('Promotion', i)">
                                <option value="-1">Select Designation</option>
                                <option [ngValue]="designation.id" *ngFor="let designation of designations">
                                  {{designation!.desg_desc}}</option>
                              </select>
                              <span *ngIf="!editable">{{desg!.desg_desc}}</span>
                            </td>
                            <td>
                              <input *ngIf="employee!.designations && editable" class="form-control" type="date"
                                     [(ngModel)]="employee!.designations[i].pivot!.join_date"
                                     (ngModelChange)="onInputChangeMap('Promotion', i)" [max]="maxDate">
                              <span *ngIf="!editable">{{formatDate(desg!.pivot!.join_date)}}</span>
                            </td>
                            <td>
                              <input *ngIf="employee!.designations && editable" class="form-control" type="text"
                                     [(ngModel)]="employee!.designations[i].pivot!.order_no"
                                     (ngModelChange)="onInputChangeMap('Promotion', i); validateOrderNo('Promotion', i)">
                              <span *ngIf="!editable">{{desg!.pivot!.order_no}}</span>
                            </td>
                            <td>
                              <input *ngIf="employee!.designations && editable" class="form-control" type="date"
                                     [(ngModel)]="employee!.designations[i].pivot!.order_date"
                                     (ngModelChange)="onInputChangeMap('Promotion', i); validateOrderDate('Promotion', i)"
                                     [max]="maxDate">
                              <span *ngIf="!editable">{{formatDate(desg!.pivot!.order_date)}}</span>
                            </td>
                            <td>
                              <div class="d-grid gap-2 d-md-block" *ngIf="employee!.designations && editable">
                                <label for="order_file_desg_{{ i }}" class="upload-icon-label btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"
                                       title="Upload Order File">
                                  <i class="bi bi-cloud-arrow-up "></i>
                                </label>

                                <input type="file" class="custom-file-input" [id]="'order_file_desg_' + i"
                                       (change)="onFileSelected($event, i);onInputChangeMap('Promotion', i)" style="display: none">
                              </div>
                            </td>
                            <td>
                              <div class="d-grid gap-2 d-md-block">
                                <ng-container
                                  *ngIf="employee!.designations && employee!.designations[i].pivot!.order_path; else naBlock">
                                  <a class="btn btn-outline-primary enlarge-on-hover" (click)="hoverClick($event)"
                                     href="{{apiUrl}}getFile/{{employee!.designations[i].pivot!.order_path}}"
                                      title="Order File" target="_blank">
                                    <i class="bi bi-eye "></i>
                                  </a>
                                </ng-container>
                                <ng-template #naBlock>
                                  N/A
                                </ng-template>
                              </div>
                            </td>
                            <td *ngIf="editable && (changesPromotionMade[i]) ">
                              <button *ngIf="desg!.pivot!.deleted_at==null" type="button"
                                      class="btn btn-outline-success enlarge-on-hover" (click)="hoverClick($event)" (click)="savePromotion(i)">Save</button>
                            </td>
                            <td *ngIf="editable">
                              <button *ngIf="desg!.pivot!.id==-1" type="button" class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                                      (click)="deleteRecord(i)">Delete</button>
                            </td>
                          </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <!-- Division/Posting Deatils Field -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                Division / Posting Details
              </button>
            </h2>
            <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
              <div class="accordion-body" *ngIf="editable">
                <div class="row">
                  <div class="col-md-10"></div>
                  <div class="col-md-2" style="text-align: right">
                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" (click)="addDivision()">
                      +Add Division
                    </button>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md">
                    <div class="card shadow table-responsive">
                      <div class="card-body">
                        <div class="row" style="text-align: center;">
                          <div class="col-md">
                            <div class="form-group">
                              <label class="form-label">
                                <u class="text-danger">Pending changes of Division/Posting Data</u>
                              </label>
                            </div>
                          </div>
                        </div>
                        <table class="table table-stripped">
                          <thead>
                          <tr>
                            <th>Division</th>
                            <th>From Date</th>
                            <th>To Date</th>
                            <th>Order No.</th>
                            <th>Order Date</th>
<!--                            <th>Order File</th>-->
                          </tr>
                          </thead>
                          <tbody *ngIf="employee!.temp_changes && employee!.temp_changes.length > 0">
                          <ng-container *ngFor="let change of employee!.temp_changes; let i = index">
                            <tr *ngIf="change.model === 'posting' && change.changed_data">
                              <td *ngIf="change.model === 'posting'">{{ change.changed_data.div_desc }}</td>
                              <td *ngIf="change.model === 'posting'">{{ formatDate(change.changed_data.from_date) }}</td>
                              <td *ngIf="change.model === 'posting'">{{ formatDate(change.changed_data.to_date) }}</td>
                              <td *ngIf="change.model === 'posting'">{{ change.changed_data.order_no }}</td>
                              <td *ngIf="change.model === 'posting'">{{ formatDate(change.changed_data.order_date) }}</td>
<!--                              <td *ngIf="change.model === 'posting'">{{ change.changed_data.order_path }}</td>-->
                            </tr>
                          </ng-container>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="accordion-body">
                <div class="row">
                  <div class="col-md">
                    <div class="card shadow table-responsive">
                      <div class="card-body">
                        <table class="table table-stripped">
                          <thead>
                          <tr>
                            <th>Sl No.</th>
                            <th>Division</th>
                            <th>From Date<span class="text-danger">*</span></th>
                            <th>To Date</th>
                            <th>Order No.<span class="text-danger">*</span></th>
                            <th>Order Date<span class="text-danger">*</span></th>
                            <th colspan="2">Order File</th>
                            <th *ngIf="editable" colspan="3">Action</th>
                          </tr>
                          </thead>
                          <tbody *ngIf="employee!=null && employee.divisions!=null">
                          <tr *ngFor="let div of employee!.divisions; let i = index">
                            <td>{{i+1}}</td>
                            <td>
                              <select *ngIf="employee!.divisions && editable" class="form-control"
                                      [(ngModel)]="employee!.divisions[i].pivot.division_id"
                                      [compareWith]="compareDivisions" (ngModelChange)="onInputChangeMap('Posting', i)">
                                <option value="-1">Select Division</option>
                                <option [ngValue]="division.id" *ngFor="let division of divisiontypelist">
                                  {{division!.div_desc}}
                                </option>
                              </select>
                              <span *ngIf="!editable">{{div!.div_desc}}</span>
                            </td>
                            <td>
                              <input *ngIf="employee!.divisions && editable" class="form-control" type="date"
                                     [(ngModel)]="employee!.divisions[i].pivot!.from_date"
                                     (ngModelChange)="onInputChangeMap('Posting', i);  validateFromDate('Posting', i)"
                                     [max]="maxDate">
                              <span *ngIf="!editable">{{formatDate(div!.pivot!.from_date)}}</span>
                            </td>
                            <td>
                              <input *ngIf="employee!.divisions && editable" class="form-control" type="date"
                                     [(ngModel)]="employee!.divisions[i].pivot!.to_date" (ngModelChange)="onInputChangeMap('Posting', i)"
                                       [max]="maxDate">
                              <span *ngIf="!editable">{{formatDate(div!.pivot!.to_date)}}</span>
                            </td>
                            <td>
                              <input *ngIf="employee!.divisions && editable" class="form-control" type="text"
                                     [(ngModel)]="employee!.divisions[i].pivot!.order_no"
                                     (ngModelChange)="onInputChangeMap('Posting', i);  validateOrderNo('Posting', i)">
                              <span *ngIf="!editable">{{div!.pivot!.order_no}}</span>
                            </td>
                            <td>
                              <input *ngIf="employee!.divisions && editable" class="form-control" type="date"
                                     [(ngModel)]="employee!.divisions[i].pivot!.order_date"
                                     (ngModelChange)="onInputChangeMap('Posting', i); validateOrderDate('Posting', i)"
                                     [max]="maxDate">
                              <span *ngIf="!editable">{{formatDate(div!.pivot!.order_date)}}</span>
                            </td>
                            <td>
                              <div class="d-grid gap-2 d-md-block" *ngIf="employee!.divisions && editable">
                                <label for="order_file_div_{{ i }}" class="upload-icon-label btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)"
                                       title="Upload Order File">
                                  <i class="bi bi-cloud-arrow-up "></i>
                                </label>

                                <input type="file" class="custom-file-input" [id]="'order_file_div_' + i"
                                       (change)="onFileDivSelected($event, i);onInputChangeMap('Posting', i)" style="display: none" >
                              </div>
                            </td>
                            <td>
                              <div class="d-grid gap-2 d-md-block">
                                <ng-container
                                  *ngIf="employee!.divisions && employee!.divisions[i].pivot!.order_path; else naBlock">
                                  <a class="btn btn-outline-primary enlarge-on-hover" (click)="hoverClick($event)"
                                     href="{{apiUrl}}getFile/{{employee!.divisions[i].pivot!.order_path}}"
                                     title="Order File" target="_blank">
                                    <i class="bi bi-eye "></i>
                                  </a>
                                </ng-container>
                                <ng-template #naBlock>
                                  N/A
                                </ng-template>
                              </div>
                            </td>
                            <td *ngIf="editable && (changesPostingMade[i]) ">
                              <button *ngIf="div!.pivot!.deleted_at==null" type="button"
                                      class="btn btn-outline-success enlarge-on-hover" (click)="hoverClick($event)" (click)="saveDivision(i)"
                                      [disabled]="!changesPostingMade">Save</button>
                            </td>
                            <td *ngIf="editable">
                              <button *ngIf="div!.pivot!.id==-1" type="button" class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                                      (click)="deleteDivision(i)">Delete</button>
                            </td>
                          </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Family Members/Relation Deatils Field -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                Family Members / Relation Details
              </button>
            </h2>
            <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
              <div class="accordion-body" *ngIf="editable">
                <div class="row">
<!--                  <div class="col-md-9"></div>-->
                  <div class="col" style="text-align: right">
                    <label class="upload-icon-label" style="margin-left: 3%;color: green;" *ngIf="!employee?.AllotmentId || employee?.AllotmentId === null"
                           title="RB quarter Exist?" (click)="pullEbaPopup()">
                      If you've applied or reside in a quarter, click the question mark icon to retrieve Family and Out House details.
                      <i class="bi bi-question-circle btn btn-warning enlarge-on-hover" (click)="hoverClick($event)"></i>
                    </label>
                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" (click)="addMember()">
                      +Add Relative
                    </button>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md">
                    <div class="card shadow table-responsive">
                      <div class="card-body">
                        <div class="row" style="text-align: center;">
                          <div class="col-md">
                            <div class="form-group">
                              <label class="form-label">
                                <u class="text-danger">Pending changes of Family/Relation Data</u>
                              </label>
                            </div>
                          </div>
                        </div>
                        <table class="table table-stripped">
                          <thead>
                          <tr>
                            <th>Name</th>
                            <th>Gender</th>
                            <th>Relation</th>
                            <th>Mobile No.</th>
                            <th>Date Of Birth</th>
                          </tr>
                          </thead>
                          <tbody *ngIf="employee!.temp_changes && employee!.temp_changes.length > 0">
                          <ng-container *ngFor="let change of employee!.temp_changes; let i = index">
                            <tr *ngIf="change.model === 'employee_rel' && change.changed_data">
                              <td *ngIf="change.model === 'employee_rel'">{{ change.changed_data.rel_name }}</td>
                              <td *ngIf="change.model === 'employee_rel'"> {{ (change.changed_data.gender) === 'M' ?
                                'Male' : (change.changed_data.gender) === 'F' ? 'Female' :
                                  (change.changed_data.gender) === 'O' ? 'OTHERS' : '' }}</td>
                              <td *ngIf="change.model === 'employee_rel'">{{ change.changed_data.rel_desc }}</td>
                              <td *ngIf="change.model === 'employee_rel'">{{ change.changed_data.rel_mobile_no }}</td>
                              <td *ngIf="change.model === 'employee_rel'">{{ formatDate(change.changed_data.rel_dob) }}</td>
                            </tr>
                          </ng-container>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="accordion-body">
                <div class="row">
                  <div class="col-md">
                    <div class="card shadow table-responsive">
                      <div class="card-body">
                        <table class="table table-stripped">
                          <thead>
                          <tr>
                            <th>Sl No.</th>
                            <th>Name</th>
                            <th>Gender</th>
                            <th>Relation</th>
                            <th>Mobile No.</th>
                            <th>Date Of Birth</th>
                            <th *ngIf="editable" colspan="3">Action</th>
                          </tr>
                          </thead>
                          <tbody *ngIf="employee!=null && employee.relations!=null">
                          <tr *ngFor="let member of employee!.relations; let i = index">
                            <td>{{ i + 1 }}</td>
                            <td>
                              <input *ngIf="employee!.relations && editable" class="form-control" type="text"
                                     [(ngModel)]="employee!.relations[i].pivot!.rel_name" placeholder="Name"
                                     (ngModelChange)="onInputChangeMap('Relations', i)">

                              <span *ngIf="!editable">{{member!.pivot!.rel_name}}</span>
                            </td>
                            <td>
                              <select *ngIf="employee!.relations && editable" class="form-control"
                                      [(ngModel)]="employee!.relations[i].pivot.gender" [compareWith]="compareGender"
                                      (ngModelChange)="onInputChangeMap('Relations', i)">
                                <option value="null">--Select Gender--</option>
                                <option [ngValue]="'M'">Male</option>
                                <option [ngValue]="'F'">Female</option>
                                <option [ngValue]="'O'">OTHERS</option>
                              </select>

                              <!-- <input *ngIf="employee!.relations && editable" class="form-control" type="text"
                                [(ngModel)]="employee!.relations[i].pivot!.rel_type" placeholder="Relation"> -->

                              <span *ngIf="!editable">
                                  {{
                                member!.pivot!.gender === 'M' ? 'Male' :
                                  member!.pivot!.gender === 'F' ? 'Female' :
                                    member!.pivot!.gender === 'O' ? 'Others' :
                                      'N/A'
                                }}
                                </span>
                            </td>
                            <td>
                              <select *ngIf="employee!.relations && editable" class="form-control"
                                      [(ngModel)]="employee!.relations[i].pivot.relation_id" [compareWith]="compareRelation"
                                      (ngModelChange)="onInputChangeMap('Relations', i)">
                                <option value="">--Select Relation--</option>
                                <option [ngValue]="relationtype.id" *ngFor="let relationtype of relationstypelist">
                                  {{relationtype!.rel_desc}}</option>
                              </select>

                              <span *ngIf="!editable">{{member!.rel_desc}}</span>
                            </td>
                            <td>
                              <input *ngIf="employee!.relations && editable" class="form-control" type="text"
                                     [(ngModel)]="employee!.relations[i].pivot!.rel_mobile_no" placeholder="Mobile No."
                                     maxlength="10" minlength="10" (ngModelChange)="onInputChangeMap('Relations', i)" (input)="onrelationMobileNo($event, i)">

                              <span *ngIf="!editable">{{member!.pivot!.rel_mobile_no}}</span>
                            </td>
                            <td>
                              <input *ngIf="employee!.relations && editable" class="form-control" type="date"
                                     [(ngModel)]="employee!.relations[i].pivot!.rel_dob"
                                     (ngModelChange)="onInputChangeMap('Relations', i)" [max]="maxDate">

                              <span *ngIf="!editable">{{formatDate(member!.pivot!.rel_dob)}}</span>
                            </td>
                            <td *ngIf="editable &&  (changesRelationMade[i])">
                              <button *ngIf="member!.pivot!.deleted_at==null" type="button"
                                      class="btn btn-outline-success enlarge-on-hover" (click)="hoverClick($event)" (click)="saveRelationDetails(i)"
                                      [disabled]="!changesRelationMade">Save</button>
                            </td>
                            <td *ngIf="editable">
                              <button *ngIf="member!.pivot!.id==-1" type="button" class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                                      (click)="deleteMember(i)">Delete</button>
                            </td>
                          </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <td>
              <ng-container>
                <div class="modal modal-above-header"
                     tabindex="-1" data-bs-backdrop="false"
                     [ngStyle]="{'display': displayEba }" style="backdrop-filter: blur(3px);background-color: rgba(128, 128, 128, 0.7); overflow-y: auto;" >
                  <div class="modal-dialog modal-dialog-centered modal-m" *ngIf=" !showquarterDetails">
                    <div class="modal-content" *ngIf="!recivedotp && !showquarterDetails">
                      <div class="modal-header">
                        <h5 class="modal-title">
                          <b> Pull Quarter Details </b>
                        </h5>
                      </div>

                      <div class="modal-body">
                        <div class="row">
                          <div class ="col-md-4" style="margin-left: 1%;">
                            <label class="form-label">Location:</label>
                          </div>
                          <div class ="col-md-8" style="margin-left: -7%" >
                            <select class="form-control" [(ngModel)]="employee!.location_id"  (change)="qtrtype()">
                              <option value="">--Select--</option>
                              <option [ngValue]="locationtype.location_code" *ngFor="let locationtype of locationtypelist">
                                {{locationtype!.location_name}}</option>
                            </select>
                          </div>
                        </div>
                          <div class="row">
                          <div class ="col-md-4" style="margin-left: 1%">
                            <label class="form-label">Quarter Type:</label>
                          </div>
                          <div class ="col-md-8" style="margin-left: -7%" >
                            <select class="form-control" [(ngModel)]="employee!.qtr_code" (change)="qtraddress()">
                              <option value="">--Select--</option>
                              <option [ngValue]="quartertype.type_code" *ngFor="let quartertype of quarterstypelist">
                                {{quartertype!.type_name}}</option>
                            </select>
                          </div>
                          </div>
                        <div class="row" *ngIf="quarterList !== null && quarterList.length > 0">
                          <div class ="col-md-4" style="margin-left: 1%">
                            <label class="form-label">Quarter address:</label>
                          </div>
                          <div class ="col-md-8" style="margin-left: -7%" >
                            <select class="form-control" [(ngModel)]="employee!.qtr" >
                              <option value="">--Select--</option>
                              <option [ngValue]="qtr" *ngFor="let qtr of quarterList">
                                {{qtr!.qtr_no}}</option>
                            </select>
                          </div>
                        </div>
                      </div>

                      <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary enlarge-on-hover" (click)="hoverClick($event)" (click)="closeEbaPopup()">
                          Close
                        </button>

                        <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" (click)="sendOtp()" *ngIf="employee!.qtr">
                          Send OTP
                        </button>
                      </div>
                    </div>


                    <div class="modal-content" *ngIf="recivedotp && !showquarterDetails">
                      <div class="modal-header">
                        <h5 class="modal-title">
                          <b>OTP </b>
                        </h5>
                      </div>

                      <div class="modal-body" style="text-align: center">
                        <br>
                        <div style="color: grey" >
                          An OTP has sent to below this number.
                        </div>
                        <div style="color: red">
                          +91 {{getMaskedNumber()}}
                        </div>
                        <br>
                        <div class="my-4">
                          <ng-otp-input  (onInputChange)="onOtpChange($event)"   [config]="configOptions"></ng-otp-input>
                        </div>
<!--                        <button class="btn btn-lg w-100 mt-3 mb-4 py-3" [ngClass]="btnStatus">{{ this.inputDigitLeft }}</button>-->
                        <br>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary enlarge-on-hover" (click)="hoverClick($event)" (click)="closeEbaPopup()">
                          Close
                        </button>

                        <button type="button" class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)" (click)="wrongQuarter()">
                          Back
                        </button>

                        <button type="button" class="btn btn-outline-warning enlarge-on-hover" (click)="hoverClick($event)" (click)="sendOtp()">
                          Resend
                        </button>

                        <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" (click)="Verifyotp()">
                          Verify
                        </button>
                      </div>
                    </div>
                  </div>

                    <div class="modal-dialog modal-dialog-centered modal-xl" *ngIf="!recivedotp && showquarterDetails">
                    <div class="modal-content" *ngIf="!recivedotp && showquarterDetails">
                      <div class="modal-header">
                        <h5 class="modal-title">
                          <b>EBA details</b>
                        </h5>
                      </div>

                      <div class="modal-body" >
                        <div class="row">
                          <div class="row">
                            <div class="col-md-2"><b>Name:</b></div>
                            <div class="col-md-10" style="font-size: 120%;margin-left: -6%;">
                              {{quarterDetails?.m_Item1?.[0]?.Name}}
                            </div>
                          </div>

                          <div class="row">
                            <div class="col-md-2"><b>Designation:</b></div>
                            <div class="col-md-10" style="margin-left: -6%;">
                              {{quarterDetails?.m_Item1?.[0]?.Designation}}
                            </div>
                          </div>

                          <div class="row">
                            <div class="col-md-2"><b>Section:</b></div>
                            <div class="col-md-10" style="margin-left: -6%;">
                              {{quarterDetails?.m_Item1?.[0]?.Section}}
                            </div>
                          </div>

                          <div class="row">
                            <div class="col-md-2"><b>Address:</b></div>
                            <div class="col-md-10" style="margin-left: -6%;">
                              {{quarterDetails?.m_Item1?.[0]?.Address}}
                            </div>
                          </div>
                        </div>
                        <br>
                        <div class="row" style="overflow-x: auto;overflow-y: hidden; white-space: nowrap;">
                          <ng-container *ngIf="quarterDetails?.m_Item1?.[0]?.Members">
                            <tr>
                            <ng-container *ngFor="let member of quarterDetails?.m_Item1?.[0]?.Members; let i = index">
                              <td>
                                <div class="d-flex flex-column align-items-center" style="width:100%; text-align: center; padding-top: 10px;">
                                    <span *ngIf="member && member.PhotoUrl">
                                      <img [src]="member.PhotoUrl" alt="Profile Photo" style="width: 150px; height: 128px"
                                           class="rounded-circle" title="Profile Photo" />
                                    </span>
                                  <ng-container *ngIf="member">
                                    <span style="font-size: 1.2em" *ngIf="member">{{member.MemberName}}</span>
                                    <span *ngIf="member.PassNo">{{member.PassNo}}</span>
                                    <!-- <span *ngIf="member!.DateOfBirth">{{formatDate(member!.DateOfBirth)}}</span> -->
                                    <!-- <span *ngIf="member!.MobileNumber">{{member!.MobileNumber}}</span> -->
                                  </ng-container>
                                </div>
                              </td>
                            </ng-container>
                            </tr>
                          </ng-container>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary enlarge-on-hover" (click)="hoverClick($event)" (click)="closeEbaPopup()">
                          Close
                        </button>
                        <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" (click)="PullEba()">
                          PULL
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
            </td>
          </div>

          <!--  Deatils of Vehicle -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                Vehicle Details
              </button>
            </h2>
            <div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
              <div class="accordion-body" *ngIf="editable">
                <div class="row">
                  <div class="col-md-10"></div>
                  <div class="col-md-2" style="text-align: right">
                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" (click)="addVehicle()">
                      +Add Vehicle
                    </button>
                  </div>
                </div>
              </div>

              <div class="accordion-body">
                <div class="row">
                  <div class="col-md">
                    <div class="card shadow table-responsive">
                      <div class="card-body">
                        <table class="table table-stripped">
                          <thead>
                          <tr>
                            <th>Sl No.</th>
                            <th>Vehicle Name</th>
                            <th>Vehicle No.</th>
                            <th>Chassis No.</th>
                            <th>Registered owner</th>
                            <th *ngIf="editable" colspan="3">Action</th>
                          </tr>
                          </thead>
                          <tbody *ngIf="employee!=null && employee.vehicles!=null">
                          <tr *ngFor="let vehicle of employee!.vehicles; let i = index">
                            <td>{{ i + 1 }}</td>

                            <td>
                              <input *ngIf="employee!.vehicles && editable" class="form-control" type="text"
                                     [(ngModel)]="employee!.vehicles[i].model_name" placeholder="Name"
                                     (ngModelChange)="onInputChangeMap('Vehicle', i)">

                              <span *ngIf="!editable">{{vehicle.model_name}}</span>
                            </td>

                            <td>
                              <input *ngIf="employee!.vehicles && editable" class="form-control" type="text"
                                     [(ngModel)]="employee!.vehicles[i].vehicle_no" placeholder="Name"
                                     (ngModelChange)="onInputChangeMap('Vehicle', i)">

                              <span *ngIf="!editable">{{vehicle.vehicle_no}}</span>
                            </td>

                            <td>
                              <input *ngIf="employee!.vehicles && editable" class="form-control" type="text"
                                     [(ngModel)]="employee!.vehicles[i].chassis_no" placeholder="Name"
                                     (ngModelChange)="onInputChangeMap('Vehicle', i)">

                              <span *ngIf="!editable">{{vehicle.chassis_no}}</span>
                            </td>

                            <td>
                              <input *ngIf="employee!.vehicles && editable" class="form-control" type="text"
                                     [(ngModel)]="employee!.vehicles[i].vehicle_owner" placeholder="Name"
                                     (ngModelChange)="onInputChangeMap('Vehicle', i)">

                              <span *ngIf="!editable">{{vehicle.vehicle_owner}}</span>
                            </td>

                            <td *ngIf="editable &&  (changesVehicle[i])">
                              <button *ngIf="vehicle!.deleted_at==null" type="button"
                                      class="btn btn-outline-success enlarge-on-hover" (click)="hoverClick($event)" (click)="saveVehicle(i)"
                                      [disabled]="!changesVehicle">Save</button>
                            </td>

                            <td *ngIf="editable">
                              <button *ngIf="vehicle!.id==-1" type="button" class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                                      (click)="removeVehicle(i)">Delete</button>
                            </td>
                          </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--  Deatils of servant field -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                Domestic Help
              </button>
            </h2>
            <div id="collapseSix" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
              <div class="accordion-body" *ngIf="editable">
                <div class="row">
<!--                  <div class="col-md-9"></div>-->
                  <div class="col" style="text-align: right">
                    <label class="upload-icon-label" style="margin-left: 3%;color: green;" *ngIf="!employee?.AllotmentId || employee?.AllotmentId === null"
                           title="RB quarter Exist?" (click)="pullEbaPopup()">
                      If you've applied or reside in a quarter, click the question mark icon to retrieve Family and Out House details.
                      <i class="bi bi-question-circle btn btn-warning enlarge-on-hover" (click)="hoverClick($event)"></i>
                    </label>
                    <button type="button" class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" (click)="addServant()">
                      +Add Domestic Help
                    </button>

                  </div>
                </div>

                <div class="row">
                  <div class="col-md">
                    <div class="card shadow table-responsive">
                      <div class="card-body" >
                        <div class="row" style="text-align: center;">
                          <div class="col-md">
                            <div class="form-group">
                              <label class="form-label">
                                <u class="text-danger">Pending changes of Domestic Help Data</u>
                              </label>
                            </div>
                          </div>
                        </div>
                        <table class="table table-stripped">
                          <thead>
                          <tr>
                            <th>Name</th>
                            <th>Gender</th>
                            <th>Mobile No.</th>
                            <th>Date Of Birth</th>
                            <th>Out House Address</th>
                          </tr>
                          </thead>
                          <tbody *ngIf="employee!.temp_changes && employee!.temp_changes.length > 0">
                          <ng-container *ngFor="let change of employee!.temp_changes; let i = index">
                            <tr *ngIf="change.model === 'servant' && change.changed_data">
                              <td *ngIf="change.model === 'servant'">{{ change.changed_data.servant_name }}</td>
                              <td *ngIf="change.model === 'servant'"> {{ (change.changed_data.gender) === 'M' ?
                                'Male' : (change.changed_data.gender) === 'F' ? 'Female' :
                                  (change.changed_data.gender) === 'O' ? 'OTHERS' : '' }}</td>
                              <td *ngIf="change.model === 'servant'">{{ change.changed_data.servant_mobile_no }}</td>
                              <td *ngIf="change.model === 'servant'">{{ formatDate(change.changed_data.servant_dob)}}</td>
                              <td *ngIf="change.model === 'servant'">{{ change.changed_data.out_house_address }}</td>
                            </tr>
                          </ng-container>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="accordion-body" *ngIf="employee != null && employee.servants != null ">
                <div class="row" *ngFor="let servant of employee.servants; let i = index">
                  <div class="container">
                    <div class="card shadow" >
                      <div class="card-body" >
                        <div class="col-md">
                          <table class="table table-stripped">
                            <thead>
                            <tr>
                              <th>Sl No.</th>
                              <th>Name</th>
                              <th>Gender</th>
                              <th>Mobile No.</th>
                              <th>Date Of Birth</th>
                              <th>Out House No</th>
                              <th *ngIf="editable" colspan="3">Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                              <td>{{ i + 1 }}</td>
                              <td>
                                <input *ngIf="employee.servants && editable" class="form-control" type="text"
                                       [(ngModel)]="employee.servants[i].servant_name" placeholder="Name"
                                       (ngModelChange)="onInputChangeMap('Servants',i)">

                                <span *ngIf="!editable">{{ servant.servant_name }}</span>
                              </td>

                              <td>
                                <select *ngIf="employee.servants && editable" class="form-control"
                                        [(ngModel)]="employee.servants[i].gender"
                                        (ngModelChange)="onInputChangeMap('Servants', i)">
                                  <option value="null">--Select Gender--</option>
                                  <option [ngValue]="'M'">Male</option>
                                  <option [ngValue]="'F'">Female</option>
                                  <option [ngValue]="'O'">OTHERS</option>
                                </select>

                                <span *ngIf="!editable">
                            {{
                                  servant!.gender === 'M' ? 'Male' :
                                    servant!.gender === 'F' ? 'Female' :
                                      servant!.gender === 'O' ? 'Others' :
                                        'N/A'
                                  }}
                          </span>
                              </td>

                              <td>
                                <input *ngIf="employee.servants && editable" class="form-control" type="text"
                                       [(ngModel)]="employee.servants[i].servant_mobile_no"  placeholder="Mobile No."
                                       maxlength="10" minlength="10" (ngModelChange)="onInputChangeMap('Servants', i)" (input)="onMobileNoInput($event, i)">

                                <span *ngIf="!editable">{{servant!.servant_mobile_no}}</span>
                              </td>

                              <td>
                                <input *ngIf="employee.servants && editable" class="form-control" type="date"
                                       [(ngModel)]="employee.servants[i].servant_dob"
                                       (ngModelChange)="onInputChangeMap('Servants', i)" [max]="maxDate">

                                <span *ngIf="!editable">{{formatDate(servant!.servant_dob)}}</span>
                              </td>

                              <td>
                                <input *ngIf="employee.servants && editable" class="form-control" type="text"
                                       [(ngModel)]="employee.servants[i].out_house_address"
                                       (ngModelChange)="onInputChangeMap('Servants', i)" >

                                <span *ngIf="!editable">{{servant!.out_house_address}}</span>
                              </td>

                              <td *ngIf="editable &&  (changesServantMade[i])">
                                <button *ngIf="servant!.deleted_at==null" type="button"
                                        class="btn btn-outline-success enlarge-on-hover" (click)="hoverClick($event)" (click)="saveServant(i)"
                                        [disabled]="!changesServantMade">Save</button>
                              </td>

                              <td *ngIf="editable">
                                <button *ngIf="servant!.id==-1" type="button" class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                                        (click)="removeServant(i)">Delete</button>
                              </td>

                            </tr>
                            </tbody>
                          </table>
                          <div class="row" *ngIf="servant && servant!.id!=-1">
                            <div class="col-md">
                              <div class="card shadow">
                                <div class="card-header">
                                  <div class="float-start">
                                    <b>{{ servant?.servant_name || "Domestic help" }}'s Relatives</b>
                                  </div>
                                  <div class="float-end" *ngIf="editable ">
                                    <button *ngIf="servant!.deleted_at==null" type="button"
                                            class="btn btn-outline-info enlarge-on-hover" (click)="hoverClick($event)" (click)="addServantFamily(i)">Add_Family</button>
                                  </div>
                                </div>
                                <div class="card-body">
                                  <table class="table table-stripped">
                                    <thead>
                                    <tr>
                                      <th>Sl No.</th>
                                      <th>Name</th>
                                      <th>Gender</th>
                                      <th>Relation</th>
                                      <th>Mobile No.</th>
                                      <th>Date Of Birth</th>
                                      <th *ngIf="editable" colspan="3">Action</th>
                                    </tr>
                                    </thead>
                                    <tbody *ngIf="employee?.servants?.[i]?.relations != null">
                                    <tr  *ngFor="let servantRelative of servant!.relations; let k = index">
                                      <td>{{ k + 1 }}</td>

                                      <td>
                                        <input *ngIf="editable" class="form-control" type="text"
                                               [(ngModel)]="employee.servants[i].relations[k].pivot!.rel_name" placeholder="Name"
                                               (ngModelChange)="onInputChangeMap('ServantRelation',k)">

                                        <span *ngIf="!editable">{{ servantRelative.pivot!.rel_name }}</span>
                                      </td>

                                      <td>
                                        <select *ngIf=" editable" class="form-control"
                                                [(ngModel)]="employee.servants[i].relations[k].pivot!.gender"
                                                (ngModelChange)="onInputChangeMap('ServantRelation', k)">
                                          <option value="null">--Select Gender--</option>
                                          <option [ngValue]="'M'">Male</option>
                                          <option [ngValue]="'F'">Female</option>
                                          <option [ngValue]="'O'">OTHERS</option>
                                        </select>


                                        <span *ngIf="!editable">
                                            {{
                                          servantRelative!.pivot!.gender === 'M' ? 'Male' :
                                            servantRelative!.pivot!.gender === 'F' ? 'Female' :
                                              servantRelative!.pivot!.gender === 'O' ? 'Others' :
                                                'N/A'
                                          }}
                                          </span>
                                      </td>

                                      <td>
                                        <select *ngIf=" editable" class="form-control"
                                                [(ngModel)]="employee.servants[i].relations[k].pivot!.relation_id" [compareWith]="compareRelation"
                                                (ngModelChange)="onInputChangeMap('ServantRelation', k)">
                                          <option value="">--Select Relation--</option>
                                          <option [ngValue]="relationtype.id" *ngFor="let relationtype of relationstypelist">
                                            {{relationtype!.rel_desc}}</option>
                                        </select>

                                        <span *ngIf="!editable">{{ servantRelative!.rel_desc }}</span>
                                      </td>

                                      <td>
                                        <input *ngIf="editable" class="form-control" type="text"
                                               [(ngModel)]="employee.servants[i].relations[k].pivot!.rel_mobile_no"  placeholder="Mobile No."
                                               maxlength="10" minlength="10" (ngModelChange)="onInputChangeMap('ServantRelation', k)" (input)="onrelMobileNoInput($event, i,k)">

                                        <span *ngIf="!editable">{{servantRelative!.pivot!.rel_mobile_no}}</span>
                                      </td>

                                      <td>
                                        <input *ngIf=" editable" class="form-control" type="date"
                                               [(ngModel)]="employee.servants[i].relations[k].pivot!.rel_dob"
                                               (ngModelChange)="onInputChangeMap('ServantRelation', i)" [max]="maxDate">

                                        <span *ngIf="!editable">{{formatDate(servantRelative!.pivot!.rel_dob)}}</span>
                                      </td>

                                      <td *ngIf="editable &&  (changesServantRelation[k])">
                                        <button *ngIf="servantRelative!.deleted_at==null" type="button"
                                                class="btn btn-outline-success enlarge-on-hover" (click)="hoverClick($event)" (click)="saveServantRel(i,k)"
                                                [disabled]="!changesServantRelation">Save</button>
                                      </td>

                                      <td *ngIf="editable">
                                        <button *ngIf="servantRelative!.id==-1" type="button" class="btn btn-outline-danger enlarge-on-hover" (click)="hoverClick($event)"
                                                (click)="removeServantRel(i,k)">Delete</button>
                                      </td>
                                    </tr>
                                    </tbody>
                                  </table>
                                </div>
                              </div>
                            </div>
                          </div>
                          <br>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
